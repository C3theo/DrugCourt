{% extends "core/home.html" %}
{% load static %}
{% block main-header %}Objectives{% endblock main-header %}
{% block content %}
<p>
    <button type="button" class="btn btn-primary js-create-model" data-url="{% url 'treatment:objectives_create' %}">
        <span class="fas fa-plus"></span>
        Add Objectives
    </button>
</p>

<table class="table table-striped table-bordered table-hover" data-url="{% url 'objectives-list' %}" , id="model-table">
    <thead>
        <tr>
            <th></th>
            <th>Client</th>
            <th>Objective</th>
            <th>Description</th>
            <th>Target</th>
            <!-- <th>Action</th> -->
            <!--             
            <th>Closed</th>
            <th>Met</th>
            <th>Met Date</th>
            <th>Treatment Rating</th>
            <th>Client Rating</th>
             -->
        </tr>
    </thead>
    <!-- <tbody>
    </tbody> -->
</table>

<div class="modal fade" id="modal-model">
    <div class="modal-dialog">
        <div class="modal-content">
        </div>
    </div>
    {% endblock content %}


    {% block extracss %}
    <link rel="stylesheet" type="text/css" href="{% static 'core/row-details.css' %}">
    {% endblock extracss %}

    {% block javascript %}

    <script>

        function format(rowData) {
            // let child_table = $('<table/>');

            // child_table.createTHead();
            // generateTableHead(child_table, rowData.goals[0]);
            // console.log(rowData.goals);

            return child_table;
        }

        function generateTableHead(table, data) {
            let $thead = $('<thead>');
            let $tr = $('<tr>');

            table.append($thead);
            $thead.append($tr);
            for (let key in data[0]) {
                let $th = $('<th>').text(key);
                $tr.append($th);
            }
        }

        function generateTable(table, data) {
            let $thead = $('<thead>');
            let $tr = $('<tr>');

            table.append($thead);
            $thead.append($tr);
            for (let key in data[0]) {
                let $th = $('<th>').text(key);
                $tr.append($th);
            }

            $tbody = $('<tbody>');
            table.append($tbody);

            for (element of data) {
                let $tr = $('<tr>');
                for (let key in element) {
                    let $td = $('<td>').text(element[key]);
                    $tr.append($td);
                    $tr.appendTo($tbody);
                    // child_table.append(tr);
                }
            }

        }

        $(document).ready(function () {
            var tbl = $('#model-table');
            var table = tbl.DataTable({
                ajax: {
                    url: tbl.attr('data-url'),
                    dataSrc: 'results'
                },
                columns: [
                    {
                        "className": 'details-control',
                        "orderable": false,
                        "data": null,
                        "defaultContent": ''
                    },
                    { data: 'client' },
                    { data: 'obj_num' },
                    { data: 'description' },
                    { data: 'obj_target' },
                ],
                order: [[1, 'asc']]
            });

            $('#model-table tbody').on('click', 'td.details-control', function () {
                var tr = $(this).closest('tr');
                var row = table.row(tr);

                if (row.child.isShown()) {
                    row.child.hide();
                    tr.removeClass('shown');
                }
                else {
                    // let table = document.querySelector("table.child");
                    // let data = Object.keys(goals[0]);

                    let goals = row.data().goals;
                    let $child_table = $('<table/>').attr({ class: 'child' });

                    // generateTableHead($child_table, goals[0]);
                    generateTable($child_table, goals);


                    row.child($child_table).show();
                    tr.addClass('shown');
                }
            });
        });

    </script>
    <!-- <script src="{% static 'core/ajaxforms.js' %}"></script> -->
    {% endblock javascript %}